<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blockchain Explorer</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<h1>ğŸ”— Mini Blockchain Viewer</h1>

<!-- Táº¡o block má»›i -->
<div class="form-section">
    <h2>ğŸ§¾ Táº¡o Block má»›i</h2>
    <form id="blockForm">
        <input type="text" id="from" placeholder="From" required>
        <input type="text" id="to" placeholder="To" required>
        <input type="number" id="amount" placeholder="Amount" required>
        <button type="submit">â• Táº¡o Block</button>
    </form>
</div>

<!-- NÃºt kiá»ƒm tra vÃ  táº£i láº¡i -->
<div class="action-section">
    <button onclick="loadChain()">ğŸ”„ LÃ m má»›i Blockchain</button>
    <button onclick="validateChain()">ğŸ§ª Kiá»ƒm tra tÃ­nh há»£p lá»‡</button>
    <p id="validation-result"></p>
</div>

<!-- Hiá»ƒn thá»‹ blockchain -->
<div id="chain"></div>

<script>
    async function loadChain() {
        const res = await fetch('/chain');
        const data = await res.json();
        const container = document.getElementById('chain');
        container.innerHTML = '';

        data.forEach((block, index) => {
            const card = document.createElement('div');
            card.className = 'block-card';
            if (index === 0) card.classList.add('genesis');

            card.innerHTML = `
          <h3>ğŸ§± Block #${index}</h3>
          <p><strong>â±ï¸ Timestamp:</strong> ${block.timestamp}</p>
          <p><strong>ğŸ”— Prev Hash:</strong> ${block.previousHash}</p>
          <p><strong>ğŸ” Hash:</strong> ${block.hash}</p>
          <p><strong>ğŸ“¦ Data:</strong> <pre>${JSON.stringify(block.data, null, 2)}</pre></p>
        `;
            container.appendChild(card);
        });
    }

    async function validateChain() {
        const res = await fetch('/validate');
        const data = await res.json();
        const resultEl = document.getElementById('validation-result');
        resultEl.textContent = data.valid
            ? 'âœ… Blockchain há»£p lá»‡'
            : 'âŒ Blockchain KHÃ”NG há»£p lá»‡!';
        resultEl.style.color = data.valid ? 'green' : 'red';
    }

    document.getElementById('blockForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const from = document.getElementById('from').value;
        const to = document.getElementById('to').value;
        const amount = parseFloat(document.getElementById('amount').value);

        await fetch('/mine', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ data: { from, to, amount } }),
        });

        // Reset form vÃ  reload
        e.target.reset();
        loadChain();
    });

    loadChain();

    async function validateChain() {
        const res = await fetch('/validate');
        const data = await res.json();
        const resultEl = document.getElementById('validation-result');

        if (data.valid) {
            resultEl.textContent = 'âœ… Blockchain há»£p lá»‡!';
            resultEl.style.color = 'green';
        } else {
            resultEl.textContent = 'âŒ Blockchain KHÃ”NG há»£p lá»‡!';
            resultEl.style.color = 'red';
        }
    }

</script>
</body>
</html>
